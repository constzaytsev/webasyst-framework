var WaLoginAbstractForm=(s=>{var r=function(){},a=(r.className="WaLoginAbstractForm",r.def=function(t,e){for(var r=0,a=arguments.length;r<a;r++)if(void 0!==arguments[r])return arguments[r]},r.def);return r.inherit=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t},r.prototype.init=function(t){var e=this;e.initVars(t),e.initSubmit(),e.initErrorsAutoCleaner(),e.showErrors(e.errors),e.setFocus(),e.initCaptcha()},r.prototype.initVars=function(t){var e=this;e.$wrapper=a(e.$wrapper,(t=t||{}).$wrapper,s()),e.$form||(e.$form=e.$wrapper.find(".js-wa-form-item"),e.$form.length||(e.$form=e.$wrapper.find("form")),e.$form.length)||(e.$form=s()),e.namespace=a(e.namespace,t.namespace,""),e.$templates=a(e.$templates,t.$templates,{}),e.$templates=s.extend({error_msg:s('<em class="wa-error-msg"></em>'),info_msg:s('<div class="wa-info-msg"></div>')},e.$templates),e.classes=a(e.classes,t.classes,{}),e.classes=s.extend({error_input:"wa-error",error_msg:"wa-error-msg",uncaught_errors:"wa-uncaught-errors",messages:"wa-info-messages",messages_wrapper:"wa-info-messages-wrapper",message_msg:"wa-info-msg",field:"field"},e.classes),e.errors=a(e.errors,t.errors,{}),e.locale=a(e.locale,t.locale,{}),e.js_validate=a(e.js_validate,t.js_validate,!0),e.is_json_mode=a(e.is_json_mode,t.is_json_mode),e.className=a(e.className,r.className),e.$captcha=a(e.$captcha,e.$wrapper.find(".wa-captcha-field")),e.need_redirects=void 0===t.need_redirects||!!t.need_redirects,e.env="",e.form_type=""},r.prototype.getFormItem=function(){return this.$form},r.prototype.getFormAction=function(){var t=this;return t.$form.is("form")?t.$form.attr("action"):t.$form.data("action")},r.prototype.getSerializedFormData=function(){var t=this.getFormItem();return(t.is("form")?t:(t.find("[data-turn-off=1]").find(":input").attr("disabled",!0),t.find(":input:not(:disabled)"))).serializeArray()},r.prototype.beforeSubmit=function(){this.getFormItem().find('[name="_csrf"]').val(function(){var t=document.cookie.match(new RegExp("(?:^|; )_csrf=([^;]*)"));return t&&t[1]?decodeURIComponent(t[1]):""})},r.prototype.setFocus=function(){},r.prototype.triggerEvent=function(t){var e=this,r={env:e.env,form_type:e.form_type,form_wrapper_id:e.$wrapper.attr("id")},a=(a=Array.prototype.slice.call(arguments)).slice(1);e.$wrapper.trigger(t,a.concat([r]))},r.prototype.initCaptcha=function(){var t,r=this,e=r.$wrapper;e.find(".wa-captcha-field").length?(t=function(){r.triggerEvent("wa_auth_form_loaded"),r.triggerEvent("wa_auth_form_change_view"),r.captchaInitialized=!0,r.processPendingSubmit()},window.captchaInitialized?t():s(window).one("wa_recaptcha_loaded wa_captcha_loaded wa_smartcaptcha_loaded",t),e.find(".wa-captcha-field").find('[name="g-recaptcha-response"]').length&&new MutationObserver(t=>{for(var e of t)"attributes"===e.type&&"value"===e.attributeName&&(r.captchaInitialized=!0,r.processPendingSubmit())}).observe(e.find(".wa-captcha-field").find('[name="g-recaptcha-response"]')[0],{attributes:!0})):(r.triggerEvent("wa_auth_form_loaded"),r.captchaInitialized=!0,r.processPendingSubmit())},r.prototype.turnOffBlock=function(t){var a=this;t.data("turnOff",1).attr("data-turn-off",1).hide(),t.find(":input").attr("disabled",!0),t.find("[type=button],:submit").each(function(){var t=s(this),e=s('<div class="wa-js-old-button-place"></div>'),r=s('<div class="wa-js-new-button-place"></div>');t.after(e),e.data("button",t),r.hide(),a.getFormItem().append(r),r.html(t)}),a.triggerEvent("wa_auth_form_change_view")},r.prototype.turnOnBlock=function(t){t.find(".wa-js-old-button-place").each(function(){var t=s(this),e=t.data("button"),r=e.parent();t.after(e),t.remove(),r.remove()}),t.data("turnOff","").attr("data-turn-off","").show(),t.find(":input").attr("disabled",!1),this.triggerEvent("wa_auth_form_change_view")},r.prototype.isJsonMode=function(){return this.is_json_mode},r.prototype.formatInfoMessage=function(t,e,r){e=void 0===e||e;var a=this.$templates.info_msg.clone();return void 0!==r&&a.data("name",r).attr("data-name",r),e?a.text(s.trim(""+t)):a.html(s.trim(""+t))},r.prototype.getInfoMessages=function(t){var e=this.$wrapper,r="."+this.classes.message_msg;return t&&(r+='[data-name="'+t+'"]'),e.find(r)},r.prototype.clearInfoMessages=function(t){this.getInfoMessages(t).remove(),this.triggerEvent("wa_auth_form_change_view")},r.prototype.showInfoMessages=function(t){var o=this,n=o.$wrapper.find("."+o.classes.messages);s.each(t||{},function(r,t){var e=o.getFormInput(r),a=[];s.each((t="string"==typeof t?[t]:t)||[],function(t,e){e=o.formatInfoMessage(e,!1,r);e.data("code",t).attr("data-code",t),a.push(e)}),e.length?e.after(a):n.show().append(a)}),o.triggerEvent("wa_auth_form_change_view")},r.prototype.clearErrors=function(t){var e=this,r=e.$wrapper,a=r.find("."+e.classes.error_input),o=!1,a=(a.removeClass(e.classes.error_input),o=o||0<a.length,r.find("."+e.classes.error_msg));t||(a=a.not("[data-not-clear=1]")),o=o||0<a.length,a.each(function(){var t=s(this);"timeout"===t.data("name")&&t.data("timer")&&t.data("timer")&&"function"==typeof t.data("timer").finish&&t.data("timer").finish()}),a.remove(),r.find("."+e.classes.uncaught_errors).find("."+e.classes.error_msg).length<=0&&(r.find("."+e.classes.uncaught_errors).hide(),o=!0),o&&e.triggerEvent("wa_auth_form_change_view")},r.prototype.getErrorTemplate=function(t,e,r){return this.$templates.error_msg},r.prototype.escape=function(t){var e=s("<div>");return e.text(s.trim(""+t)),t=e.text(),e.remove(),t},r.prototype.prepareErrorText=function(t,e,r){return this.escape(e)},r.prototype.prepareErrorItem=function(t,e,r){var a=this.getErrorTemplate(t,e,r).clone().clone();return a.data("name",t).data("code",r).attr("data-name",t).attr("data-code",r),a.html(this.prepareErrorText(t,e,r)),a},r.prototype.showInputError=function(t,e){t=this.getFormInput(t);return!!t.length&&(t.parent().append(e),t.addClass(this.classes.error_input),!0)},r.prototype.getFormInput=function(t){var e=this.getFormItem(),t=this.buildFormInputName(t);return e.find('[name="'+t+'"]')},r.prototype.buildFormInputName=function(t){var e=this.namespace;return e?e+"["+t+"]":t},r.prototype.getFormField=function(t){return this.$wrapper.find("."+this.classes.field+'[data-field-id="'+t+'"]')},r.prototype.getInfoMessageItem=function(t,e){t=this.$wrapper.find("."+this.classes.message_msg+'[data-name="'+t+'"]');return void 0!==e?t.filter('[data-code="'+e+'"]'):t},r.prototype.getErrorItem=function(t,e){t=this.$wrapper.find("."+this.classes.error_msg+'[data-name="'+t+'"]');return void 0!==e?t.filter('[data-code="'+e+'"]'):t},r.prototype.showUncaughtErrors=function(t,e,r){var a=this.$wrapper.find("."+this.classes.uncaught_errors);return!!a.length&&(a.show(),r&&a.html(""),a.show().append(e),!0)},r.prototype.afterShowErrors=function(){},r.prototype.showErrors=function(t){var r=this;s.each(t||{},function(t,e){e=r.prepareErrorItems(t,e="string"==typeof e?[e]:e);r.showInputError(t,e)||r.showUncaughtErrors(t,e,!0)||!console||!console.error||s.each(e,function(){var t="Uncaught validate error: "+s(this).text();console.error(t)})}),r.afterShowErrors(),r.triggerEvent("wa_auth_form_change_view")},r.prototype.initSubmit=function(){function r(t){(t=e.onSubmit(t))&&(o&&o.abort(),o=t)}var e=this,a=e.getFormItem(),o=null;a.is("form")?a.submit(function(t){r(t)}):(a.on("click",":submit,button",function(t){var e=s(this);e.is(":disabled")||e.data("ignore")||(t.preventDefault(),r(t))}),a.on("keydown","input",function(t){13==t.keyCode&&(t.preventDefault(),a.find(":submit,button").not(":disabled").filter(":first").trigger("click"))}))},r.prototype.validate=function(){return{}},r.prototype.initErrorsAutoCleaner=function(){var o=this,t=o.getFormItem(),n={},e=":text:not([name="+o.buildFormInputName("captcha")+"]),:password";t.find(e).each(function(){var t=s(this),e=t.attr("name"),t=t.val();n[e]={val:s.trim(t||""),timer:null}}),t.on("keydown",e,function(t){var e,r,a;13!=t.keyCode&&(t=(e=s(this)).attr("name"),r=n[t]||{},a=s.trim(r.val||""),(t=r.timer||null)&&clearTimeout(t),r.timer=setTimeout(function(){var t=s.trim(e.val()||"");t!==a&&o.clearErrors(),r.val=t},300))}),t.on("change",":input",function(){var t=s(this),e=t.attr("name"),e=n[e]||{},r=s.trim(e.val||""),t=s.trim(t.val()||"");t!==r&&o.clearErrors(),e.val=t})},r.prototype.onDoneSubmitHandlers=function(){var r=this;return{errors:function(t,e){return r.showErrors(t),!0},redirect:function(t){return-1!==(t=t||"").indexOf("#")&&t===window.location.href?window.location.reload():window.location.href=t,!0},messages:function(t){return r.showInfoMessages(t),!0},rest:function(t){return!0}}},r.prototype.onDoneSubmit=function(t){var e=this.onDoneSubmitHandlers(),r=t&&"ok"===t.status,a=(t&&t.data||{}).messages||{},o=t&&t.errors||{};if(r||!e.errors||!e.errors(o,t)){if(this.isRedirectResponse(t)){r=this.getRedirectUrl(t);if(e.redirect&&e.redirect(r,t))return}!s.isEmptyObject(a)&&(e.messages&&e.messages(a,t))||e.rest&&e.rest(t)}},r.prototype.submit=function(t){t=t||{};var e=this;if(e.beforeSubmit(),e.clearErrors(!0),e.js_validate){var r=e.validate();if(!s.isEmptyObject(r))return void e.showErrors(r)}var r=e.getFormItem(),a=t.$button||r.find(":submit"),o=t.$loading||r.find(".wa-loading"),r=t.url||e.getFormAction(),n=e.getSerializedFormData();if(o.show(),a.attr("disabled",!0),document.cookie.includes("_csrf=")||e.captchaInitialized)return e.jsonPost(r,n).done(function(t){e.isRedirectResponse(t)||(a.attr("disabled",!1),o.hide()),e.onDoneSubmit(t)}).fail(function(){a.attr("disabled",!1)});e.pendingSubmit=function(){e.submit(t)}},r.prototype.processPendingSubmit=function(){this.pendingSubmit&&(this.pendingSubmit(),this.pendingSubmit=null)},r.prototype.onSubmit=function(t){if(this.isJsonMode())return t.preventDefault(),this.submit()},r.prototype.mixinVarsInData=function(t,r){return s.isPlainObject(r)?r=s.extend(r,t):s.isArray(r)?s.each(t,function(t,e){r.push({name:t,value:e})}):r&&s.each(t,function(t,e){r+="&"+t+"="+e}),r},r.prototype.beforeJsonPost=function(t,e){var r={wa_json_mode:1,need_redirects:this.need_redirects?1:0};return e=this.mixinVarsInData(r,e)},r.prototype.isRedirectResponse=function(t){return null!==this.getRedirectUrl(t)},r.prototype.getRedirectUrl=function(t){t=t&&"ok"===t.status&&t.data&&t.data.redirect_url;return"string"==typeof t?t:null},r.prototype.jsonPost=function(t,e){var r=this;return e=r.beforeJsonPost(t,e),s.post(t,e,"json").always(function(t){r.isRedirectResponse(t)||s(".wa-captcha-refresh").trigger("click")})},r.prototype.beforeErrorTimerStart=function(t,e,r){},r.prototype.afterErrorTimerFinish=function(t,e,r){},r.prototype.prepareTimeoutErrorItem=function(t,e,r){var a=this,o=a.prepareErrorItem("timeout",t);return r=r||{},a.beforeErrorTimerStart(t,e,r),o.data("notClear",1).attr("data-not-clear",1),a.runTimeoutMessage(o,{timeout:e,onFinish:function(){o.remove(),a.afterErrorTimerFinish(t,e,r)}}),o},r.prototype.prepareErrorItems=function(r,t){var e,a=this,o=[];return"timeout"===r?(e=t.message,o=[a.prepareTimeoutErrorItem(e,t.timeout,{error_namespace:r})]):s.each(t||[],function(t,e){e="timeout"===t?a.prepareTimeoutErrorItem(e.message,e.timeout,{error_namespace:r,error_code:t}):a.prepareErrorItem(r,e,t);o.push(e)}),o},r.prototype.runTimeoutMessage=function(a,t){var o,n=t.timeout,e=s.trim(a.html()),r=t.onFinish,i=null,n=parseInt(n,10);if(n=!isNaN(n)&&0<n?n:60,r="function"==typeof r?r:null,e.match(/\d+:\d/))return this.triggerEvent("wa_auth_form_change_view"),o=function(){i&&clearInterval(i),a.remove(),r&&r()},i=setInterval(function(){var t,e,r;--n<=0?o():(r=a.html(),t=parseInt(n/60,10),e=n%60,r=r.replace(/\d+:\d+/,(t<=9?"0"+t:t)+":"+(e<=9?"0"+e:e)),a.html(r))},1e3),a.data("timer",t={finish:o}),t},r})(jQuery),WaLoginAbstractSetPasswordForm=(n=>{var e=WaLoginAbstractSetPasswordForm=function(){},r=(e.className="WaLoginAbstractSetPasswordForm",WaLoginAbstractForm),a=WaLoginAbstractForm.def;return WaLoginAbstractForm.inherit(e,r),e.prototype.initVars=function(t){this.className=a(this.className,e.className),r.prototype.initVars.call(this,t),this.form_type="setpassword"},e.prototype.validate=function(){var a=this,t=a.getSerializedFormData(),o={},t=(n.each(t,function(t,e){var r=e.name,e=n.trim(e.value||"");r!==a.buildFormInputName("login")||e?r!==a.buildFormInputName("password")||e?r!==a.buildFormInputName("captcha")||e||(o.captcha=[a.locale.captcha_required||a.locale.required||""]):o.password=[a.locale.password_required||a.locale.required||""]:o.login=[a.locale.login_required||a.locale.required||""]}),a.getFormInput("password")),e=a.getFormInput("password_confirm");return n.trim(t.val()||"")!==n.trim(e.val()||"")&&(o.password_confirm=[a.locale.not_match||""]),o},e})(jQuery),WaFrontendSetPassword=(e=>{var r=function(t){this.init(t)},a=(r.className="WaFrontendSetPassword",WaLoginAbstractSetPasswordForm);return WaLoginAbstractForm.inherit(r,a),r.prototype.initVars=function(t){this.className=r.className,a.prototype.initVars.call(this,t),this.initHash(t.hash),this.env="frontend"},r.prototype.initHash=function(t){var r,a=this;a.hash=t||"",a.hash||(r=location.href,e.each([/key=([^&]+)/,/hash=([^&]+)/],function(t,e){e=e.exec(r);if(e&&e[1])return a.hash=e[1],!1}))},r.prototype.beforeJsonPost=function(t,e){return e=a.prototype.beforeJsonPost.call(this,t,e),e=this.mixinVarsInData({hash:this.hash},e)},r.prototype.onDoneSubmitHandlers=function(){var e=this,t=a.prototype.onDoneSubmitHandlers.call(e);return t.rest=function(t){!0===t.data.set_password&&(e.triggerEvent("wa_auth_reset_password"),e.triggerEvent("wa_auth_contact_logged",t.data.contact||{})),!0===t.data.generated_password_sent&&e.triggerEvent("wa_auth_resent_password")},t},r})(jQuery);
//# sourceMappingURL=setpassword-frontend-form.min.js.map
